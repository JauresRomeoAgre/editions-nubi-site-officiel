<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>√âditions Nubi ‚Äì Commande</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    /* --- STYLES (Identiques pour garder votre design) --- */
    :root { --bleu-ciel: #8ec5fc; --bleu-nuit: #152238; --fond: #f7f9fc; }
    body { font-family: system-ui, sans-serif; background: var(--fond); color: #222; line-height: 1.6; margin:0; padding:0; }
    
    .wrapper { max-width: 800px; margin: 0 auto; padding: 20px; }
    
    .card { background: #fff; border-radius: 1rem; padding: 1.5rem; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    
    label { display:block; margin-top:1rem; font-weight:bold; font-size:0.9rem; }
    select, input { width:100%; padding:0.5rem; margin-top:0.3rem; border:1px solid #ccc; border-radius:0.4rem; font-size:1rem; }
    
    .btn-order {
      background: #2563eb; color: #fff; font-weight: 600; padding: 1rem 2rem;
      border: none; border-radius: 50px; cursor: pointer; display: block; width: 100%;
      font-size: 1.1rem; margin-top: 2rem; transition: background 0.2s;
    }
    .btn-order:hover { background: #1d4ed8; }
    
    .hidden { display: none; }
    
    h2 { text-align: center; color: var(--bleu-nuit); }
    .info { font-size: 0.85rem; color: #666; margin-top: 0.5rem; }
  </style>
</head>
<body>

<div class="wrapper">
  <h2>Bon de Commande Nubi</h2>
  
  <form id="commandeForm" class="card">
    
    <label>1. R√©gion</label>
    <select id="region" onchange="changerRegion()">
      <option value="">-- Choisir --</option>
      <option value="afrique">Afrique</option>
      <option value="europe">Europe</option>
      <option value="amerique">Am√©rique</option>
      <option value="asie">Asie</option>
    </select>

    <label>2. Pays</label>
    <select id="pays" onchange="changerPays()">
      <option value="">-- Choisir d'abord une r√©gion --</option>
    </select>

    <div id="bloc-ci" class="hidden">
      <label>Zone (C√¥te d'Ivoire)</label>
      <select id="zoneCI" onchange="changerZone()">
        <option value="">-- Choisir une zone --</option>
        <option value="Abidjan">Abidjan</option>
        <option value="Bingerville">Bingerville</option>
        <option value="Dabou">Dabou</option>
        <option value="Interieur">Int√©rieur du pays</option>
      </select>
      
      <div id="bloc-ville" class="hidden" style="margin-left: 1rem; border-left: 2px solid #ddd; padding-left: 1rem;">
        <label>Nom de la ville :</label>
        <input type="text" id="villeInterieur" placeholder="Ex: Yamoussoukro">
      </div>
    </div>

    <label>3. Vous √™tes</label>
    <select id="statut" onchange="changerStatut()">
      <option value="">-- Choisir --</option>
      <option value="parent">Parent</option>
      <option value="librairie">Librairie</option>
      <option value="ecole">√âcole</option>
      <option value="bibliotheque">Biblioth√®que</option>
      <option value="autre">Autre</option>
    </select>

    <label>4. Livre</label>
    <select id="livre">
      <option value="Le Petit Nuage Qui Avait Peur de Pleuvoir">Le Petit Nuage Qui Avait Peur de Pleuvoir</option>
    </select>

    <label>5. Quantit√©</label>
    <select id="quantiteSelect" onchange="changerQuantite()">
      <option value="">-- Choisir statut d'abord --</option>
    </select>
    <input type="number" id="quantiteInput" class="hidden" placeholder="Saisir la quantit√©" min="1" oninput="calculerTotal()">

    <label>Devise</label>
    <select id="devise" onchange="calculerTotal()">
      <option value="XOF">Franc CFA (FCFA)</option>
      <option value="EUR">Euro (‚Ç¨)</option>
      <option value="USD">Dollar ($)</option>
    </select>

    <div style="background: #eef; padding: 10px; border-radius: 5px; margin-top: 10px; text-align: center;">
      <strong>Total Estim√© : </strong> <span id="totalAffiche">0</span>
    </div>

    <div style="margin-top: 2rem; border-top: 2px dashed #ddd; padding-top: 1rem;">
      <label>Moyen d'envoi de la commande :</label>
      <div style="margin-top:0.5rem;">
        <label style="display:inline; margin-right:15px;">
          <input type="radio" name="modeEnvoi" value="email" checked onclick="changerMode('email')"> Par E-mail
        </label>
        <label style="display:inline;">
          <input type="radio" name="modeEnvoi" value="whatsapp" onclick="changerMode('whatsapp')"> Par WhatsApp
        </label>
      </div>

      <div id="bloc-email">
        <label>Votre adresse E-mail :</label>
        <input type="email" id="emailClient" placeholder="ex: mon-nom@gmail.com">
      </div>

      <div id="bloc-whatsapp" class="hidden">
        <label>Votre Num√©ro WhatsApp :</label>
        <div style="display: flex; gap: 5px; align-items: center;">
          <span id="indicatif" style="font-weight:bold; background:#eee; padding:5px 10px; border-radius:4px;">+225</span>
          <input type="tel" id="telClient" placeholder="Num√©ro sans indicatif">
        </div>
        <p class="info">Exemple pour la CI : 0707070707 (10 chiffres)</p>
      </div>
    </div>

    <button type="button" class="btn-order" onclick="lancerLaCommande()">
      ENVOYER LA COMMANDE
    </button>

  </form>
</div>

<script>
  // --- DONN√âES ---
  const CONFIG = {
    emailDest: "contact@editionsnubi.com",
    whatsappDest: "2250709850776", // Ne pas mettre de +
    prix: { XOF: 10000, EUR: 14.49, USD: 16.99 }
  };

  const DATA = {
    afrique: ["C√¥te d'Ivoire", "S√©n√©gal", "Mali", "Burkina Faso", "Togo", "B√©nin", "Cameroun", "Maroc"],
    europe: ["France", "Belgique", "Suisse"],
    amerique: ["Canada", "USA"],
    asie: ["Chine", "Japon"]
  };
  
  const INDICATIFS = {
    "C√¥te d'Ivoire": "+225", "S√©n√©gal": "+221", "Mali": "+223", "France": "+33", "Belgique": "+32", "Canada": "+1"
  };

  // --- FONCTIONS ---

  function changerRegion() {
    const region = document.getElementById('region').value;
    const selectPays = document.getElementById('pays');
    selectPays.innerHTML = '<option value="">-- Choisir pays --</option>';
    
    if (DATA[region]) {
      DATA[region].forEach(p => {
        let opt = document.createElement('option');
        opt.value = p; opt.text = p;
        selectPays.add(opt);
      });
    }
    cacherCI();
  }

  function changerPays() {
    const pays = document.getElementById('pays').value;
    const indicatif = INDICATIFS[pays] || "+";
    document.getElementById('indicatif').innerText = indicatif;
    
    if (pays === "C√¥te d'Ivoire") {
      document.getElementById('bloc-ci').style.display = 'block';
    } else {
      cacherCI();
    }
  }

  function cacherCI() {
    document.getElementById('bloc-ci').style.display = 'none';
    document.getElementById('zoneCI').value = "";
    document.getElementById('bloc-ville').style.display = 'none';
  }

  function changerZone() {
    const zone = document.getElementById('zoneCI').value;
    if (zone === 'Interieur') {
      document.getElementById('bloc-ville').style.display = 'block';
    } else {
      document.getElementById('bloc-ville').style.display = 'none';
    }
  }

  function changerStatut() {
    const st = document.getElementById('statut').value;
    const qSelect = document.getElementById('quantiteSelect');
    qSelect.innerHTML = "";
    
    let opts = [];
    if (st === 'librairie' || st === 'ecole') opts = [5, 10, 20, 50, "Autre"];
    else opts = [1, 2, 3, 5, "Autre"];

    opts.forEach(v => {
      let opt = document.createElement('option');
      opt.value = v; opt.text = v;
      qSelect.add(opt);
    });
    changerQuantite();
  }

  function changerQuantite() {
    const val = document.getElementById('quantiteSelect').value;
    if (val === "Autre") {
      document.getElementById('quantiteInput').style.display = 'block';
      document.getElementById('quantiteInput').value = "";
    } else {
      document.getElementById('quantiteInput').style.display = 'none';
      document.getElementById('quantiteInput').value = val;
    }
    calculerTotal();
  }

  function calculerTotal() {
    const qte = document.getElementById('quantiteInput').value;
    const dev = document.getElementById('devise').value;
    const total = qte * CONFIG.prix[dev];
    
    let txt = "0";
    if (total > 0) {
      if (dev === 'XOF') txt = total.toLocaleString('fr-FR') + " FCFA";
      else txt = total.toFixed(2) + " " + dev;
    }
    document.getElementById('totalAffiche').innerText = txt;
  }

  function changerMode(mode) {
    if (mode === 'email') {
      document.getElementById('bloc-email').style.display = 'block';
      document.getElementById('bloc-whatsapp').style.display = 'none';
    } else {
      document.getElementById('bloc-email').style.display = 'none';
      document.getElementById('bloc-whatsapp').style.display = 'block';
    }
  }

  // --- LA FONCTION PRINCIPALE ---
  function lancerLaCommande() {
    // 1. Test imm√©diat pour voir si le bouton marche
    console.log("Clic d√©tect√© !");

    // 2. R√©cup√©ration des valeurs
    const region = document.getElementById('region').value;
    const pays = document.getElementById('pays').value;
    const statut = document.getElementById('statut').value;
    const qte = document.getElementById('quantiteInput').value;
    const total = document.getElementById('totalAffiche').innerText;
    
    // 3. Validation avec ALERT (impossible √† rater)
    if (!region || !pays) { alert("‚ùå Attention : Veuillez s√©lectionner un Pays."); return; }
    if (!statut) { alert("‚ùå Attention : Veuillez indiquer votre statut (Parent, Librairie...)."); return; }
    if (!qte || qte < 1) { alert("‚ùå Attention : Quelle quantit√© de livres voulez-vous ?"); return; }

    // Validation CI
    let infoZone = "";
    if (pays === "C√¥te d'Ivoire") {
      const zone = document.getElementById('zoneCI').value;
      if (!zone) { alert("‚ùå Attention : Veuillez choisir votre zone en C√¥te d'Ivoire."); return; }
      if (zone === "Interieur") {
        const ville = document.getElementById('villeInterieur').value;
        if (!ville) { alert("‚ùå Attention : Veuillez √©crire le nom de votre ville."); return; }
        infoZone = " - Zone : Int√©rieur (" + ville + ")";
      } else {
        infoZone = " - Zone : " + zone;
      }
    }

    // Validation Contact
    const mode = document.querySelector('input[name="modeEnvoi"]:checked').value;
    let contactInfo = "";
    
    if (mode === 'email') {
      const email = document.getElementById('emailClient').value;
      if (!email || !email.includes('@')) { alert("‚ùå Attention : Adresse E-mail invalide."); return; }
      contactInfo = email;
    } else {
      const tel = document.getElementById('telClient').value;
      if (!tel || tel.length < 8) { alert("‚ùå Attention : Num√©ro WhatsApp trop court."); return; }
      contactInfo = document.getElementById('indicatif').innerText + tel;
    }

    // 4. Construction du message
    const message = 
      `*NOUVELLE COMMANDE NUBI*\n` +
      `------------------------\n` +
      `üìç Lieu : ${pays} ${infoZone}\n` +
      `üë§ Statut : ${statut}\n` +
      `üìö Quantit√© : ${qte} exemplaires\n` +
      `üí∞ Total : ${total}\n` +
      `------------------------\n`;

    // 5. Envoi
    if (mode === 'email') {
      alert("‚úÖ Tout est bon ! Redirection vers votre E-mail...");
      const sujet = encodeURIComponent("Commande Livre Nubi");
      const corps = encodeURIComponent(message + `\nMon E-mail : ${contactInfo}\n\nMerci de m'envoyer les instructions de paiement.`);
      window.location.href = `mailto:${CONFIG.emailDest}?subject=${sujet}&body=${corps}`;
    } else {
      alert("‚úÖ Tout est bon ! Ouverture de WhatsApp...");
      const corps = encodeURIComponent(message + `\nMon Contact : ${contactInfo}\n\nBonjour, je veux valider cette commande.`);
      window.open(`https://wa.me/${CONFIG.whatsappDest}?text=${corps}`, '_blank');
    }
  }
</script>

</body>
</html>
